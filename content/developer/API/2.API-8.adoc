---
title: 17.API-8
weight: 18
---

:toc:
:toclevels: 5

SuiteCRM API version 8 exposes a set of resources, to be consumed by clients who wish to harness the powerful CRM functionality provided by SuiteCRM. 
The API framework employs a Restful design to facilitate the http://jsonapi.org/format/1.0/[JSON API 1.0]standard messages over HTTPS. It includes meta objects to provide functionality which is not yet defined in the JSON API 1.0 standard. The SuiteCRM API is secured by 
the OAuth 2 Server provided in SuiteCRM.


== SuiteCRM API Requirements

Please ensure that you have the following:

* OpenSSL PHP Extension installed and configured


== Configure SuiteCRM API (Version 8)

Before you can consume the API, you must first configure SuiteCRM to
grant access to a client. SuiteCRM 7.10 does not yet provide a
administrative panel. So you will need to run an SQL Query to add the
client to the database.

 INSERT INTO OAuth2Clients (id, secret) VALUES ('ExampleClientName', 'ExampleSecretPassword')

[width="80",cols="20,60",options="header",]
|=======================================================================
|Field |Description
|id |Defines the *client_id* which is posted to the server during
authentication

|secret |Defines the *client_secret* which is posted to the server
during authentication
|=======================================================================


=== SuiteCRM API Requirements

* Mod Rewrite Apache2 Module to be configured
* OpenSSL PHP Extension


=== Apache2 Server

Those who have upgraded from an older version of SuiteCRM, will need to
run the "rebuild .htaccess" tool. As the API uses "friendly" urls to
define resources. It may be possible to use the API without this
feature. However, you will want the .htaccess file to configure the
_/api_ entrypoint to the _lib/API/public_ folder.

*The Mod Rewrite Apache2 Module must be installed and configured*


=== IIS Server

IIS Server Administrators will need create a web.config file manually
configure the `_/api_` entrypoint to the `_lib/API/public_` folder.

*It is important to ensure that the `lib/API/OAuth2/` directory cannot be
accessed over a HTTP request*


== Obtaining A JWT Session Token

To consume resources, the SuiteCRM API requires that a client has an
active session. Sessions are acquired by authenticating with the
http://oauth2.thephpleague.com/[OAuth 2 Server], using one of the
available grant types. As of SuiteCRM 7.10, the password grant is
enabled.


=== Password Grant

Here are a list of parameters you need to post to
*https://path-to-instance/api/oauth/access_token*

[width="40",cols="20,20",options="header",]
|======================================
|param |value
|grant_type |password
|client_id |*ExampleClientName*
|client_secret |*ExampleSecretPassword*
|scope |basic
|username |*admin*
|password |*secret*
|======================================

Please change the values in bold to match your chosen authentication
details.

Example Response:

[source, php]
{
   "token_type":"Bearer",
   "expires_in":3600,
   "access_token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6IjdkOTEyODNhMjc1NDdkNDRlMzNmOTc5ZjVmMGRkYzQwNzg1ZGY5NGFhMWI5MDVlZGNmMzg3NWIxYjJkZDMzNDljZWEyNjZhMTQ2OTE5OWIzIn0.eyJhdWQiOiJzdWl0ZWNybV9jbGllbnQiLCJqdGkiOiI3ZDkxMjgzYTI3NTQ3ZDQ0ZTMzZjk3OWY1ZjBkZGM0MDc4NWRmOTRhYTFiOTA1ZWRjZjM4NzViMWIyZGQzMzQ5Y2VhMjY2YTE0NjkxOTliMyIsImlhdCI6MTUxODE5NTEwMiwibmJmIjoxNTE4MTk1MTAyLCJleHAiOjE1MTgxOTg3MDIsInN1YiI6IjEiLCJzY29wZXMiOltdfQ.EVGuRisoMxSIZut3IWtgOYISw8lEFSZgCWYCwseLEfOuPJ8lRMYL4OZxhu9gxJoGF0nj3yc6SYDPxovrsoj8bMoX38h4krMMOHFQLoizU0k2wAceOjZG1tWKPhID7KPT4TwoCXbb7MqAsYtVPExH4li7gSphJ8wvcWbFdS5em89Ndtwqq3faFtIq6bv1R4t0x98HHuT7sweHUJU40K9WQjbAfIOk8f5Y6T2wassN2wMCBB8CC6eUxLi14n2D6khHvkYvtPbXLHpXSHZWvEhqhvjAeSR5MmMrAth9WDSWUx7alO-ppsZpi8U7-g9Be5p6MRatc25voyTI2iTYbx02FQ",
   "refresh_token":"def50200d2fb757e4c01c333e96c827712dfd8f3e2c797db3e4e42734c8b4e7cba88a2dd8a9ce607358d634a51cadd7fa980d5acd692ab2c7a7da1d7a7f8246b22faf151dc11a758f9d8ea0b9aa3553f3cfd3751a927399ab964f219d086d36151d0f39c93aef4a846287e8467acea3dfde0bd2ac055ea7825dfb75aa5b8a084752de6d3976438631c3e539156a26bc10d0b7f057c092fce354bb10ff7ac2ab5fe6fd7af3ec7fa2599ec0f1e581837a6ca2441a80c01d997dac298e1f74573ac900dd4547d7a2a2807e9fb25438486c38f25be55d19cb8d72634d77c0a8dfaec80901c01745579d0f3822c717df21403440473c86277dc5590ce18acdb1222c1b95b516f3554c8b59255446bc15b457fdc17d5dcc0f06f7b2252581c810ca72b51618f820dbb2f414ea147add2658f8fbd5df20820843f98c22252dcffe127e6adb4a4cbe89ab0340f7ebe8d8177ef382569e2aa4a54d434adb797c5337bfdfffe27bd8d5cf4714054d4aef2372472ebb4"`
 }

[width="80",cols="20,60",options="header",]
|=======================================================================
|param |description
|token_type |the Bearer token value

|expires_in |an integer representing the TTL of the access token

|access_token |a JWT signed with the authorization server’s private key

|refresh_token |an encrypted payload that can be used to refresh the
access token when it expires.
|=======================================================================


== Getting the available resources

You can retrieve the https://swagger.io/specification/[swagger
documentation] from https://path-to-instance/api/v8/swagger.json


== Validating the messages

You can retrieve the JSON API Schema from
https://swagger.io/specification/[swagger documentation] from
https://path-to-instance/api/v8/schema


== Handling Errors

The JSON API specifies the errors object to send messages back to the
user. SuiteCRM API errors are exceptions which have been thrown.

The error elements are textual content which reside in brackets eg.
&#91;409&#93;. A good method to quickly finding the source of the error,
is to use the last error element in the message to search the Project.
When the issue is a client side problem with the body of the request, it
is likely that the source will display where the issue is. All errors
are logged and posted back to the client application.

.suitecrm.log
[source, php]
Tue Sep 26 13:51:17 2017 [697][1][FATAL] [ERROR] Code: [8006] Status: [409] Message: [SuiteCRM] [API] [Conflict] ["id" already exist] "11c48ede-e9c6-6c15-fa37-59b66a8dbeab" Detail: ["Unable create record, because it already exists."] Source: [/data/attributes/id]

.JSON API Response
[source,php]
{
  "errors": [
    {
      "code": 8006,
      "title": "[SuiteCRM] [API] [Conflict] [\"id\" already exist] \"11c48ede-e9c6-6c15-fa37-59b66a8dbeab\"",
      "detail": "Unable create record, because it already exists.",
      "source": {
        "pointer": "/data/attributes/id"
      },
      "status": 409
    }
  ]`
}


== Debugging REST

In order to use the debugger with the SuiteCRM API, you can add the following to the resource URL:

.Example
[source,php]
https://path-to-instance/api/v8/module/Accounts?XDEBUG_SESSION_START=13537

This ensures that the breakpoints you have specified will be triggered in your Integrated Developement Environment (IDE).

== Additional Functionality

The SuiteCRM API includes meta objects to provide functionality which is
not yet defined in the JSON API 1.0 standard. The following are section
define how these functions operate.


=== Files

To create notes and documents, you will need to be able to upload files.
This uses fields which have the type set to "file". The SuiteCRM API
expects the contents of the file to be assigned to the \{fieldname}_file
attribute. The contents must be a base64 encoded string. When requesting
a note or a document, the API will decode the file in the same request.

.Example payload for notes
[source,php]
{
  "data": {
    "id": "",
    "type": "Notes",
    "attributes": {
      "name": "Test",
      "portal_flag": true,
      "filename": "testFile.txt",
      "filename_file": "U3VpdGVDUk0gaXMgdGhlIGJlc3Q="
    }
  }
}

.Example payload for documents:
[source,php]
{
  "data": {
    "id": "",
    "type": "Documents",
    "attributes": {
      "name": "testFile.png",
      "document_name": "testFile.png",
      "active_date": "2017-11-17T11:40:00+00:00",
      "portal_flag": true,
      "revision": "1",
      "filename": "testFile.txt",
      "filename_file": "U3VpdGVDUk0gaXMgdGhlIGJlc3Q="
   }
}


=== Relationship Fields

To create a meeting, you need to provide the invitees and there accept
status.

.POST api/v8/modules/Meetings Payload
[source,php]
{
  "data": {  
    "id": "",  
    "type": "Meetings",  
    "attributes": {  
      "name": "RelationshipsTest",  
      "date_start": "2017-11-07T10:55:4300:00",  
      "date_end": "2017-11-07T11:10:4300:00",  
      "duration_hours": "",  
      "duration_minutes": 15,  
      "assigned_user_id": "1",  
      "assigned_user_name": "Administrator"  
    },  
    "relationships": {  
      "users": {  
        "data": [  
          {  
            "id": "1",  
            "type": "User",  
            "meta": {  
              "middle_table": {  
                "data": {  
                  "id": "",  
                  "type": "Link",  
                  "attributes": {  
                    "accept_status": "accept",  
                    "user_id": "1"  
                  }  
                }  
              }  
            }  
          },  
          {  
            "id": "seed_max_id",  
            "type": "Users",  
            "meta": {  
              "middle_table": {  
                "data": {  
                  "id": "",  
                  "type": "Link",  
                  "attributes": {  
                    "accept_status": "none",  
                    "user_id": "seed_max_id"  
                  }  
                }  
              }  
            }  
          },  
          {  
            "id": "seed_chris_id",  
            "type": "Users",  
            "meta": {  
              "middle_table": {  
                "data": {  
                  "id": "",  
                  "type": "Link",  
                  "attributes": {  
                    "accept_status": "none",  
                    "user_id": "seed_chris_id"  
                  }  
                }  
              }  
            }  
          }  
        ]  
      }  
    }  
  } 
}

{{% notice note %}}
Please ensure that you include the meta middle table in each link
in the relationship otherwise it will set all the middle table fields to
the first meta object.
{{% /notice %}}


=== Filtering

The JSON Api (v1.0.0) does not specify which strategy to use when
filtering, instead the *filter* query parameter is reserved for
filtering. So this section attempts to describe the filtering strategy
implemented in SuiteCRM.


==== Pre-made Filters

You can specify a pre-made filter like so

 GET /api/v8/modules/\{module}?filter=\{name}

* *{name}* represents the name of the filter

Example use the roi filter and sort by total_revenue in descending order

 GET /api/v8/modules/Leads?filter=roi&sort=-total_revenue


==== Filter by id

If you need to retrieve a set of modules you can use the following call

 GET /api/v8/modules/\{module}?filter[id]=\{id},...

* *\{type}* represents represent the module type:
* *\{filter}* represents the id for the module type

To get a list of accounts with the id of 1, 2, and 3:

 GET /api/v8/modules/Accounts?filter[Accounts]=1,2,3


==== Filter by attributes

 GET/api/v8/modules/\{module}?filter[\{type}.\{attribute}]=&#91;&#91;\{operator}&#93;&#93;\{comparator},...

* *{type}* represents represent the module type:
* *{attribute}* represents an attribute name eg. date_modified
* *{operator}* represents a &#91;&#91;API-8#Operators|filter operation&#93;&#93;
* *{comparator}* represents the attribute value to compare against eg 2017-11-17T11:40:00+00:00

 GET /api/v8/modules/\{module}?filter[Accounts.date_modified]=&#91;&#91;gt&#93;&#93;2017-11-17T11:40:00+00:00


===== Filter relationships

 GET /api/v8/modules/\{module}?filter[\{type}.\{related type}.\{attribute}]=&#91;&#91;\{operator}&#93;&#93;\{comparator},...

 GET /api/v8/modules/Accounts?filter[Accounts.Contacts.date_modified]=&#91;&#91;gt&#93;&#93;2017-11-17T11:40:00+00:00


===== Filter Middle Table fields

 GET /api/v8/modules/\{module}?filter[\{type}.\{related type}.meta.middle_table.\{attribute}]=&#91;&#91;\{operator}&#93;&#93;\{comparator},...

* *{related type}* represents the link for the related module type
* *{attribute}* represents an attribute name eg. date_modified
* *{operator}* represents a &#91;&#91;API-8#Operators|filter
operation&#93;&#93;
* *{comparator}* represents the attribute value to compare against eg
2017-11-17T11:40:00+00:00

 GET /api/v8/modules/Meetings?filter[Meetings.Users.meta.middle_table.accept_status]=&#91;&#91;eq&#93;&#93;Accept


==== Operators

The operators are represented by string values, so that they are not
encoded, plus it will make it easier to extend operations in the future.

*Comparators*

[width="90",cols="20,20,50",options="header",]
|=======================================================================
|Operator |Name |Example
|eq |Equal |filter[Accounts.deleted]=&#91;&#91;eq&#93;&#93;1

|ne |Not Equal |filter[Accounts.deleted]=&#91;&#91;ne&#93;&#93;0

|gt |Greater Than
|filter[Accounts.date_modified]=&#91;&#91;gt&#93;&#93;2017-11-17T11:40:00+00:00

|lt |Less Than
|filter[Accounts.date_modified]=&#91;&#91;lt&#93;&#93;2017-11-17T11:40:00+00:00

|gte |Greater Than or Equal
|filter[Accounts.date_modified]=&#91;&#91;gte&#93;&#93;2017-11-17T11:40:00+00:00

|lte |Less Than or Equal
|filter[Accounts.date_modified]=&#91;&#91;lte&#93;&#93;2017-11-17T11:40:00+00:00

|in |In List
|filter[Accounts.name]=&#91;&#91;in&#93;&#93;inc,&#91;&#91;in&#93;&#93;ltd

|nin |Not In List
|filter[Accounts.name]=&#91;&#91;nin&#93;&#93;inc,&#91;&#91;nin&#93;&#93;ltd
|=======================================================================

*Strings*

[width="80",cols="20,20,40",options="header",]
|================================================================
|Operator |Name |Example
|li |Like |filter[Accounts.name]=&#91;&#91;li&#93;&#93;sam%
|nli |Not Like |filter[Accounts.name]=&#91;&#91;nli&#93;&#93;bob%
|================================================================

This convention was taken from the
https://docs.mongodb.com/manual/reference/operator/query/[MongoDb]
syntax.


==== Multiple Comparators vs Multiple Filters

When you need to create multiple conditions on a field, Due the length
limitation of a url, it is recommended that you use the multiple
comparator notation.

*Comparators separated by ","*

 GET /api/v8/modules/Accounts?filter[Contacts.date_modified]=[gte]2017-11-17T11:40:00+00:00,[lte]2017-11-18T11:40:00+00:00

When you need to filter by multiple fields, you should use the multiple
filters notation.

*Filters separated by "&"*

 GET /api/v8/modules/Accounts?filter[Contacts.date_modified]=[gte]2017-11-17T11:40:00+00:00&filter[Contacts.last_contacted]=[lte]2017-11-18T11:40:00+00:00


==== Inclusion of fields

The filter only controls how the data is filtered. How the data is
presented is handled separately. You can use the
http://jsonapi.org/format/1.0/#fetching-includes[fields] query parameter
to select the fields, or use the
http://jsonapi.org/format/1.0/#fetching-sparse-fieldsets[include] query
parameter to select to include the related types you wish to be in the
response.